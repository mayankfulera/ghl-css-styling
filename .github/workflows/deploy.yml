name: Deploy to Render

on:
  push:
    branches:
      - main
  schedule:
    - cron: "*/1 * * * *"  # Runs every 14 minutes to keep Render API awake

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to Render
        run: |
          curl -X POST https://api.render.com/deploy/srv-cuqbkb0gph6c73d0ke50?key=rnd_AzBjsRHVKwSjyxvUVvXmprvK2UKD

  keep_alive:
    runs-on: ubuntu-latest

    steps:
      - name: Keep Render API Awake (Try 3 Times)
        run: |
          MAX_RETRIES=3
          for i in $(seq 1 $MAX_RETRIES); do
            RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" https://ghl-css-styling.onrender.com/keep-alive)
            echo "Attempt $i - Keep-Alive Response Code: $RESPONSE"
            
            if [ "$RESPONSE" -eq 200 ]; then
              echo "✅ Keep-Alive request succeeded!"
              exit 0
            else
              echo "⚠️ Keep-Alive request failed, retrying in 5 seconds..."
              sleep 5
            fi
          done
          
          echo "❌ All attempts failed! Render might still be sleeping."
          exit 1
